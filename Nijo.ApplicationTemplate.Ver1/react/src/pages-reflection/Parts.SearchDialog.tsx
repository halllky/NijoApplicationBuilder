import * as ReactHookForm from "react-hook-form"
import { Panel, PanelResizeHandle } from "react-resizable-panels"
import { PanelGroup } from "react-resizable-panels"
import { MetadataForPage } from "../__autoGenerated/util/metadata-for-page"
import { ReflectionForm } from "./Parts.Form"
import { MetadataSchema } from "./getSchema"

/** 外部参照の検索ダイアログ */
export type SearchDialogComponent = () => React.ReactNode

/**
 * 外部参照の検索ダイアログのコンテンツ。
 * ほぼMultiViewのコンテンツと同じだが、PageFrameは使わない。
 */
export const createSearchDialogContents = (
  metadata: MetadataForPage.RefMetadata,
  rootAggregatePhysicalName: string,
  schema: MetadataSchema,
  formMethods: ReactHookForm.UseFormReturn<ReactHookForm.FieldValues>
): SearchDialogComponent => {

  const refToAggregateMetadata = schema.findRefTo(metadata.refTo)

  return () => (
    <div>
      <h1>SearchDialog</h1>

      <PanelGroup direction="vertical">
        <Panel collapsible minSize={8}>
          <div className="h-full overflow-y-auto">
            <ReflectionForm
              mode="search-condition"
              metadataPhysicalName={rootAggregatePhysicalName}
              metadata={refToAggregateMetadata}
              schema={schema}
              formMethods={formMethods}
            />
          </div>
        </Panel>

        <PanelResizeHandle className="h-1 bg-gray-300" />

        <Panel>

        </Panel>
      </PanelGroup>
    </div>
  )
}