import * as ReactHookForm from "react-hook-form"
import { RouteObjectWithSideMenuSetting } from "../routes"
import { MetadataForPage } from "../__autoGenerated/util/metadata-for-page"
import { getSchema } from "./getSchema"
import { MultiView } from "./MultiView"
import { SingleView } from "./SingleView"

/**
 * 自動生成されたメタデータを用いて既定の画面を作成し、
 * それらをルーティング設定に変換して返す。
 */
export const getReflectionPages = (): RouteObjectWithSideMenuSetting[] => {
  const schema = getSchema()
  return Object.entries(schema.metadata).flatMap(([rootAggregatePhysicalName, structureMetadata]) => {
    const multiView = <MultiView rootAggregatePhysicalName={rootAggregatePhysicalName} metadata={structureMetadata} />
    const singleView = <SingleView metadata={structureMetadata} />

    // 編集モードのキー
    const keys = schema.enumerateKeyVMs(structureMetadata)

    return [{
      // 一覧検索画面
      path: `${rootAggregatePhysicalName}`,
      sideMenuLabel: structureMetadata.displayName,
      element: multiView,
    }, {
      // 詳細編集画面（新規モード）
      path: `${rootAggregatePhysicalName}/new`,
      element: singleView,
    }, {
      // 詳細編集画面（編集モード）
      path: `${rootAggregatePhysicalName}/detail/${keys.map((_, i) => `:key${i}`).join('/')}`,
      element: singleView,
    }]
  })
}