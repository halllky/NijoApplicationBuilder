# EditableGrid
このドキュメントは [EditableGrid.tsx](./EditableGrid.tsx) でexportされるコンポーネントの仕様を示す。
このコンポーネントは仕様が複雑なため、特別に仕様書を起こしている。

EditableGridは TanStack Table ライブラリを用いて実装される。

## 型定義
[EditableGrid.d.ts](./EditableGrid.d.ts) の定義に従う。
EditableGridは当該 `.d.ts` ファイルで定義される props, ref の操作を全て満たす。

## パーツ
EditableGridは大きく以下4種類のパーツから成る。

- 列ヘッダ
  - グリッド内部がスクロールされても列ヘッダは常に表示される。
  - ユーザーが各列ヘッダの境界部分をドラッグすると、列幅を変更することができる。
- 行ヘッダ
  - グリッド内部がスクロールされても行ヘッダは常に表示される。
  - `showCheckBox` が指定されている場合、行ヘッダにチェックボックスが表示される。チェックされている行は選択行（selectedRows）されている行となる。
- ボディ
  - 列ヘッダと行ヘッダに囲まれた本体部分。
- 左上角のセル
  - ユーザーが左上角のセルをクリックすると、そのグリッド全体をセル範囲選択（selectedRange）の対象とし、かつボディのうち先頭行・先頭列のセルがアクティブセルになる。
  - `showCheckBox` が指定されている場合、全選択チェックボックスが表示される。

## 仮想化
EditableGridは TanStack Virtual を用いて仮想化される。

## 選択
EditableGridは「アクティブセル（activeCell）」「セル範囲選択（selectedRange）」「選択行（selectedRows）」の3つの概念を持つ。

- アクティブセル（activeCell）
  - ボディのうちユーザーの入力を受け付けるセル。EditableGridは常に1つのアクティブセルを持つ。
  - ユーザーがキーボードの矢印キーを押下するとアクティブセルは上下左右に移動する。
  - ユーザーがマウスダウンするとアクティブセルは当該押下されたセルに移動する。
- セル範囲選択（selectedRange）
  - ボディのうち選択されている範囲の矩形。
  - ユーザーがキーボード操作で Ctrl + C を押すと、その範囲をTSV形式でクリップボードにコピーすることができる。
- 選択行（selectedRows）
  - 行ヘッダのチェックボックスで選択されている行を表す。

## 編集
- ユーザーがキーボードでF2キーを押下したとき、当該セルが読み取り専用でなければ、アクティブセルの編集モードに入る。
- ユーザーがEnterキーを押すと編集が確定され、 `onChangeRow` イベントが発火する。ただし、IME確定のEnterの場合は発火しない。
