- [NijoApplicationBuilder - スキーマ駆動型アプリケーション生成フレームワーク](#nijoapplicationbuilder---スキーマ駆動型アプリケーション生成フレームワーク)
  - [開発手順概要](#開発手順概要)
    - [0. 初期設定](#0-初期設定)
    - [1. スキーマ定義を作成](#1-スキーマ定義を作成)
    - [2. コード自動生成を実行する](#2-コード自動生成を実行する)
    - [3. 自動生成で賄えない機能を自前で実装する](#3-自動生成で賄えない機能を自前で実装する)
  - [主要なプロジェクト構造](#主要なプロジェクト構造)
  - [ライセンス](#ライセンス)


# NijoApplicationBuilder - スキーマ駆動型アプリケーション生成フレームワーク
NijoApplicationBuilderは、XMLベースのスキーマ定義からアプリケーションコードの一部を自動生成するフレームワークです。
主として、特定の業務フローをサポートするためのアプリケーションのフルスクラッチ開発を補助することを主眼としています。

2025年現在のソフトウェアアーキテクチャは、複数の技術スタックを駆使してアプリケーションを組み上げることが一般的です。
例えば、RDBMSとWebを用いて住所録アプリケーションを作るとき、このアプリケーションで「氏名・住所・郵便番号・電話番号」という構造のデータを管理する必要があるとします。
ここで、RDBのテーブル定義、Webのフロントエンド、Webのバックエンドの全てで、この4項目をもったオブジェクトがそれぞれ定義され、かつそれらの構造は常に同期されている必要があります。

このフレームワークは、XMLベースのスキーマ定義をもとに、以下のソースコードを自動生成することで、
より品質の高いアプリケーションのスクラッチ開発をサポートすることができます。

- それぞれの技術スタックごとに適したオブジェクト構造定義（RDBMSのテーブル定義、C#のクラス、TypeScriptの型定義など）
- ORM(Entity Framework Core)のモデル構造定義
- データモデルに基づくCRUD操作
- 必須入力チェックなどのデータ構造から自動的に決まるバリデーション処理

また、当然ながらアプリケーションはデータ構造だけで完結することはできず、以下のような機能も必要になります。

- データ構造だけでは決まらない複雑な業務ルール
- 画面, UIコンポーネント
- 認証・認可
- エラーハンドリング
- ログ出力

このフレームワークでは、ソースコードの自動生成を用いながら組み上げるアプリケーションのサンプルとして
[Nijo.ApplicationTemplate.Ver1](./Nijo.ApplicationTemplate.Ver1/README.md) を用意しています。
サンプルは SQLite や React.js を用いてアプリケーションを構築していますが、
必ずしもこれらのライブラリに依存する必要はなく、必要に応じて別の技術基盤に変更することができます。

開発者は、当該サンプルをベースに、システムごとの個別の要求に合わせて適宜技術基盤を組み換えつつ、
ソースコードの自動生成処理を組み合わせることで、ビジネスロジックの実装に集中しながら堅牢なアプリケーションを効率的に構築することができます。

## 開発手順概要
このツールを用いてアプリケーションを開発する大まかな手順を説明します。

0. 初期設定
1. スキーマ定義を作成
2. コード自動生成を実行する
3. 自動生成で賄えない機能を自前で実装する

![開発手順概要](./README_files/README.drawio.svg)

### 0. 初期設定
以下のコマンドを実行し、新しいアプリケーションを作成してください。

```cmd
cd <新しいアプリケーションのソースコードを配置したいフォルダ>
nijo.exe new
```

ここで作成されるのは、NijoApplicationBuilderが提供する標準のスキーマ定義と標準のアプリケーションテンプレートです。

- 標準のスキーマ定義 `nijo.xml` は、あなたが具体的にどのようなデータ構造を定義できるかのイメージをつかむためのものです。
  そのまま使用する必要は無いため、適宜書き換えてください。
- 標準のアプリケーションテンプレートでは、 React.js, ASP.NET Core, SQLite を用いた、動作する完全なアプリケーションを用意しています。
  あなたは必ずしもこのテンプレートを用いる必要はなく、ASP.NET Core と TypeScirpt を用いる技術スタックであれば任意の構成を使うことができます。
  RDBMSについては、 Entity Framework Core が対応可能なものであればそのまま利用できます。これはこのフレームワークではなく Entity Framework Core の制約です。
  JavaやKotlinやCOBOLなど、ここで用意されている言語以外での構造体定義が必要な場合、コード生成エンジンの方に改修を加える必要があるため、そのままでは使えません。

### 1. スキーマ定義を作成
開発を進めるにあたり、スキーマ定義が変更になることは頻繁に発生します。
その都度、 `nijo.xml` を書き換えてください。
スキーマ定義のより詳細な仕様や、nijo.xml の具体的な記述方法については、コード生成エンジンである [`Nijo` プロジェクトのドキュメント](./Nijo/README.md) を参照してください。

### 2. コード自動生成を実行する
`nijo generate` コマンドを実行し、コード自動生成を実行します。
このコマンド実行時には、スキーマ定義のバリデーションが行われ、不正な定義がある場合はエラーが出力されます。
以下はWindowsでのコマンド実行例です。 `<nijo.xmlがあるフォルダ>` の箇所は各自の環境に応じて読み替えてください。

```cmd
cd <nijo.xmlがあるフォルダ>
nijo.exe generate
```

このコマンドの実行により、当該アプリケーションにあるいくつかの `__AutoGenerated` という名前のフォルダ内に、ソースコードが自動生成されます。
なお、 `__AutoGenerated` 内のファイルは `generate` コマンド実行の度に毎回洗い替えられます。

### 3. 自動生成で賄えない機能を自前で実装する
当然ながらアプリケーションはデータ構造だけで完結することはできず、UI、データ構造から一意には決まらない制約、CI/CD用の仕組みなど、種々のカスタマイズを加える必要があります。
自動生成されたソースを利用しながら、アプリケーションとして必要な残りの部分を定義してください。

以上、1, 2, 3 のサイクルを繰り返しながら、アプリケーションを完成させていってください。

## 主要なプロジェクト構造
プロジェクトは以下の主要コンポーネントで構成されています。
また、主要なフォルダには `README.md` ファイルを配置しています。
そのフォルダに配置されているモジュールの責務や概要を把握するのに利用してください。

- [`Nijo/`](./Nijo/README.md): コード生成エンジン。XMLスキーマ解析とコード生成を行ないます。
  - [Models](Nijo/Models/README.md) : スキーマ定義から生成される各種モデルの実装
  - [ValueMemberTypes](Nijo/ValueMemberTypes/README.md) : 標準データ型の定義
  - [SchemaParsing](Nijo/SchemaParsing/README.md) : nijo.xmlのパース処理に関する実装
  - その他の生成ロジック
- [`Nijo.ApplicationTemplate.Ver1/`](./Nijo.ApplicationTemplate.Ver1/README.md): アプリケーションテンプレート。
- [`Nijo.IntegrationTest/`](./Nijo.IntegrationTest/): ソースコード自動生成処理のユニットテスト。
  - `DataPatterns/`: テスト用のデータパターン


## ライセンス
このプロジェクトは[LICENSE.txt](./LICENSE.txt)の条件の下で提供されています。
