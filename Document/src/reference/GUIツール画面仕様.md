# GUIツール画面仕様

[[toc]]

## ツールバー

### アプリケーション名
アプリケーション名を表示します。この名称は設定画面で編集できます。

### 設定ボタン
アプリケーション全体の設定や、このツールの操作性に関する設定を行なうダイアログを開きます。

#### アプリケーション設定

チーム全体に適用される設定を構成します。
この設定は `nijo.xml あああ` に保存されます。

::: danger TODO
ここに [GeneratedProjectOptions](../../../Nijo/CodeGenerating/GeneratedProjectOptions.cs) から自動生成されるドキュメントへのリンクを張る
:::

#### 個人設定

自身にのみ適用される設定を構成します。
設定は端末ローカル上のユーザー個人の保存領域に保存されます。

このセクションでは以下の設定を編集できます。

- コメント記載時の自身の名前
- グリッドのショートカットボタンを非表示にするかどうか
- キーボードショートカット

### 集約追加ボタン
新しいルート集約を追加するモーダルダイアログを開きます。

### 集約削除ボタン
現在選択されているルート集約とその子孫メンバーを削除します。

### 属性種類ボタン
属性種類定義モーダルダイアログを開きます。
属性種類定義では、 DataModel, CommandModel, QueryModel の項目の種類として使用できる属性が一覧されます。

以下の属性の定義はこのダイアログで編集することができます。

- 静的区分
- 動的区分

::: warning 文字、数値、時間系属性などの仕様変更について
静的区分・動的区分以外の属性の仕様は変更できません。
よほどニーズがあれば拡張できるようにするかもしれませんが、当面その予定はありません。
:::

### デバッグメニュー
編集されたスキーマ定義にしたがって、実際のソースコード自動生成や、アプリケーションのデバッグ開始を行います。

### 保存ボタン
スキーマ定義をファイルに保存します。

::: tip 保存先について
データは端末ローカル上にあるファイルに保存されます。

したがって複数名による同時編集はサポートされていません。
複数名で同時に利用する場合は、別途Gitなどのバージョン管理ツールと併用してください。
:::

## 集約ダイアグラム
スキーマ定義全体のデータとそれらの関連性を一覧するための欄です。

- ダイアグラムはその背景をマウスドラッグしてスクロールさせることができます。
- マウスホイールで拡大率を変更することができます。

### スキーマ定義モード
DataModel, CommandModel, QueryModel の集約が有向グラフとして表示されます。

#### ノード
集約が有向グラフのノードとして表示されます。

ルート集約のみ表示するか、子孫集約も含めて表示するかを選択することができます。
子孫集約も表示する場合、同じ集約の中の子孫集約（ `child` , `children` ）はノードの包含関係として表されます。

- ノードはマウスドラッグでその位置を自由に移動することができます。
- 「整列」ボタンを押すことで、ノードを自動的に整列させることもできます。

#### エッジ
外部参照（ `ref-to:` ）による参照関係が有向グラフのエッジとして表現されます。

また、集約間のメンションのつながりもエッジで表現されます。
集約編集グリッドの説明欄では、他の集約に対して「半角スペース + `@` 」でメンションをつけることができますが、この関係性は点線で表現されます。

::: tip 集約間のメンションの使い方
例えば以下のような3つの集約があるとき、これらの間に `ref-to:` による外部参照のつながりは無いので、そのままではダイアグラム上にエッジが現れず、一見して関連があるように見えません。
しかし、実際にはつながりがあるため、こういった関係性をグラフ上で表現するために使用します。

|                        | 種類         | 説明                                 |
| :--------------------- | :----------- | :----------------------------------- |
| 日次作業実績           | DataModel    | 締め処理のインプット                 |
| 締め処理               | CommandModel | 日次実績から過去分作業実績を作成する |
| 締め済み過去分作業実績 | DataModel    | 締め処理のアウトプット               |

:::

### ER図モード
集約のうち DataModel のみがピックアップされ、ER図（Entity Relationship Diagram）として表示されます。

#### ノード
テーブルが有向グラフのノードとして表示されます。

テーブル名、カラム名、どのカラムが主キー（Primary Key）かの情報が表示されます。

#### エッジ
外部キー（Foreign Key）があるテーブル間がエッジで表現されます。

同じ集約の親子テーブル（child, children）と、外部参照（`ref-to:`）がこれに該当します。

## 集約編集グリッド
集約ダイアグラム上で選択されている集約の内容を編集することができます。

- 表示
  - 「主要な列のみ表示」をチェックすると、項目名や種類などの主要な列のみの表示に切り替わります。ゼロから集約定義を開始している場合など、概要を検討している場合に利用してください。
- 操作
  - キーボードショートカットによる行移動、行追加、削除ができます。
  - キーボードショートカットによるインデントの上げ下げができます。
  - F2キーなどによるセル内容の編集ができます。
  - Ctrl + C, Ctrl + V によるセル内容のコピーペーストができます。
  - 操作のやり直し（UNDO, REDO）はサポートされていません。

:::info ルート集約の行
ルート集約（先頭行）は移動やインデントの上げ下げができません。
ルート集約を削除する場合はツールバーのボタンから削除してください。
:::

:::danger TODO
ここに自動生成された属性項目の説明へのリンクを張る
:::

## エラーメッセージ欄
集約定義にエラーがある場合、ここに表示されます。
表示内容をクリックすると当該エラーがある集約が選択されます。

エラーがある状態でもスキーマ定義を保存することはできますが、ソースコードの自動生成はできません。
