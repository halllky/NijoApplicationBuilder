# スキーマパース処理

このフォルダには、nijo.xmlのパース処理に関する実装が含まれています。

## 主な責務

- nijo.xmlの読み込みと解析
- スキーマ定義の妥当性検証
- スキーマ定義からオブジェクトモデルへの変換

## 処理フロー

1. XMLファイルの読み込み
2. スキーマ定義の構文解析
3. バリデーションチェック
4. 内部モデルへの変換

## 関連コンポーネント

- [`../Models/`](../Models/): 変換先の内部モデル定義
- [`../ImmutableSchema/`](../ImmutableSchema/): 不変なスキーマ定義

## スキーマ解析の外部仕様

### XML構文の基本構造
nijo.xmlの基本構造とルートエレメントについて説明します。

```xml
<?xml version="1.0" encoding="utf-8"?>
<nijo version="1.0">
  <!-- モデル定義 -->
</nijo>
```

### ノードタイプと解析ルール
スキーマ定義で使用される主要なノードタイプと、それぞれの解析ルールについて説明します。

#### ノードタイプ
スキーマパース処理で認識される主要なノードタイプは [E_NodeType.cs](./E_NodeType.cs) で定義されており、以下のようなものがあります：

- データモデル関連ノード
- クエリモデル関連ノード
- コマンドモデル関連ノード
- 静的列挙型関連ノード
- 値オブジェクト関連ノード
- メンバー定義ノード

#### 解析ルール
解析ルールは [SchemaParseRule.cs](./SchemaParseRule.cs) で定義されており、以下のような検証が行われます：

- 必須属性の存在確認
- 属性値の型検証
- 名前の一意性検証
- 参照整合性検証
- 循環参照検証

### ノードオプション
各ノードに設定できるオプション属性について説明します。

#### 共通オプション
すべてのノードタイプで使用できる共通オプション：

- `name`: 物理名（識別子）
- `displayName`: 表示名
- `description`: 説明
- `note`: 注釈（開発者向けメモ）

#### 特殊オプション
特定のノードタイプでのみ使用できる特殊オプション：

- データモデル固有オプション
  - `table`: テーブル名
  - `schema`: スキーマ名
  - `isHistoryManaged`: 履歴管理の有無
  - `isLogicalDeleteEnabled`: 論理削除の有無

- クエリモデル固有オプション
  - `dataSource`: データソース定義
  - `pagingEnabled`: ページング有無
  - `defaultPageSize`: デフォルトページサイズ

- メンバー固有オプション
  - `type`: データ型
  - `isRequired`: 必須かどうか
  - `isUnique`: 一意制約の有無
  - `defaultValue`: デフォルト値

### バリデーションルール
スキーマ定義のバリデーションルールについて説明します。

#### 構文検証
XML構文の基本的な検証：

- XML整形式チェック
- 必須要素・属性の存在確認
- 値の型チェック

#### セマンティック検証
意味的な検証：

- 名前の一意性
- 参照先の存在確認
- 循環参照の検出
- データ型の互換性

#### エラーハンドリング
エラー発生時の処理：

- エラーメッセージのフォーマット
- 処理の中断基準
- 警告とエラーの区別

### エラーコードと対応方法
主要なエラーコードとその対応方法について説明します。

#### エラーコード例
- `SCHEMA001`: XML構文エラー
- `SCHEMA002`: 必須属性不足
- `SCHEMA003`: 重複名エラー
- `SCHEMA004`: 参照先不存在
- `SCHEMA005`: 循環参照検出

#### 対応方法
各エラーの対応方法や修正の指針
