# モデル定義
このフォルダには、スキーマ定義から生成される各種モデルの実装が含まれています。
nijo.xmlのルート要素直下のXML要素は、その種類によりどういったソースコードが生成されるかが異なります。例えば、永続化されるべきデータを表したモデル(DataModel)からは、RDBMSのテーブル定義や、Entity Framework Core のDbContextの設定が生成されます。一方、画面や帳票に表示されるべきデータを表したモデル(QueryModel)からは、検索条件のオブジェクト定義や、検索処理が生成されます。このフォルダにはモデル毎にそのモデルからどういったソースコードが生成されるべきかを定義する処理が書かれています。

このフォルダのルートに置かれるファイルは必ず `...Model.cs` という名前を持ちます。
また、そこで定義されるクラスは必ず [IModel](../CodeGenerating/IModel.cs) インターフェースを具備します。

各モデルから生成される各種モジュールは `...ModelModules` という名前のフォルダに入っています。
IModelのクラスは、それと対応する `...ModelModules` フォルダの各モジュールのレンダリングメソッドを呼び出し、生成後のプロジェクトにどういったファイルが生成されるべきかを定義します。

各モデルが何を表しているかはそのモデルの `HelpTextMarkdown` プロパティを参照してください。

## 主な責務
- スキーマ定義の内部表現モデル
- コード生成のための中間モデル
- モデル間の変換ロジック

## スキーマ定義の外部仕様

### モデルタイプ
ここでは、nijo.xmlで定義できる主要なモデルタイプとその構成要素について説明します。

#### DataModel
永続化されるデータモデルを表します。RDBMSのテーブル定義やEntity Framework Coreの設定が生成されます。

- **構成要素**：
  - スカラー値メンバー（プリミティブ型）
  - 参照メンバー（他のモデルへの参照）
  - 集約メンバー（1対多の関係）
  - 主キー・外部キー定義
  - インデックス定義
  - デフォルト値と制約

#### QueryModel
画面や帳票に表示されるデータを表します。検索条件のオブジェクト定義や検索処理が生成されます。

- **構成要素**：
  - 表示用スカラーメンバー
  - 検索条件メンバー
  - ソート順定義
  - ページング設定
  - データソース定義（SQLクエリなど）

#### CommandModel
ユーザーの操作などによって実行されるコマンドを表します。APIエンドポイントやバリデーション処理が生成されます。

- **構成要素**：
  - コマンドパラメータ
  - 入力検証ルール
  - 前処理・後処理定義
  - トランザクション設定

#### StaticEnumModel
静的な列挙型を表します。C#の列挙型やTypeScriptの定数定義などが生成されます。

- **構成要素**：
  - 列挙値
  - 表示名
  - 説明
  - ソート順

#### ValueObjectModel
値オブジェクトを表します。複数のプリミティブ値をひとまとめにした不変オブジェクトが生成されます。

- **構成要素**：
  - スカラー値メンバー
  - バリデーションルール
  - 等価比較処理

### モデル間の関係
モデル間の関係性を定義する方法について説明します。

- 参照関係（1対1、多対1）
- 集約関係（1対多）
- 依存関係

### 共通設定項目
すべてのモデルに共通する設定項目について説明します。

- 物理名（データベース上の名前）
- 論理名（画面表示用の名前）
- 説明文
- 履歴管理設定
- 論理削除設定
- ソフトウェア生成設定（C#/TypeScript/React）

### スキーマオプション
モデル定義に追加できるオプションについて説明します。

- 国際化対応
- 権限制御
- 監査証跡
- カスタム属性
