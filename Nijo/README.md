- [Nijo プロジェクト](#nijo-プロジェクト)
  - [Nijo プロジェクトを用いた開発の概要](#nijo-プロジェクトを用いた開発の概要)
  - [プロジェクト構成](#プロジェクト構成)
  - [スキーマ定義の概要](#スキーマ定義の概要)
  - [コーディング規約など、このプロジェクト開発者向けの記述](#コーディング規約などこのプロジェクト開発者向けの記述)

# Nijo プロジェクト
このプロジェクトは、スキーマ定義（nijo.xml）からソースコードを自動生成するプロジェクトです。
このプロジェクトが担うのはあくまでソース生成のみであり、生成されたあとのプロジェクトは、このプロジェクトを一切参照しません。


## Nijo プロジェクトを用いた開発の概要
Nijo プロジェクトは、リポジトリ全体の開発手順における「スキーマ定義に基づくソースコードの自動生成」というフェーズを担います。
リポジトリルートの [README.md](../README.md) に記載の開発手順と合わせて参照してください。

主な処理の流れは以下の通りです。これは開発サイクルの中で頻繁に繰り返されます。

1. 開発者は、要件定義や外部設計などの結果に基づき、このアプリケーションが採るべきデータ構造をスキーマ定義ファイル (`nijo.xml`) に記述します。
2. 開発者は、`nijo.exe generate` コマンドを実行し、ソースコードの自動生成を開始します。
   1. `nijo.exe` は、まずスキーマ定義 (`nijo.xml`) を読み取り、[SchemaParsingContext](./SchemaParsing/SchemaParseContext.cs) を用いてその妥当性を検証します。この段階では、循環参照や未定義の参照といったスキーマ定義の不備が検出される可能性があります。
   2. 検証が通った場合、`nijo.exe` は [CodeRenderingContext](./CodeGenerating/CodeRenderingContext.cs) を通してソースコード生成処理を実行します。生成されたソースコードは、アプリケーションテンプレート内の `__AutoGenerate` （JavaScriptプロジェクトの場合は `__autoGenerated`）という名前のフォルダに配置されます。この自動生成処理 ([IModel](./CodeGenerating/IModel.cs) を継承するクラス群など) は、スキーマ定義が完全に正当であることを前提として動作します。
3. 生成されたソースコードを元に、開発者はアプリケーションに必要な残りの機能を実装します。

プロジェクトテンプレートの初期作成（開発の最初期のみ）については、リポジトリルートの [README.md](../README.md) を参照してください。


## プロジェクト構成
- [`CodeGenerating/`](./CodeGenerating/README.md): ソースコード生成処理の実装を容易にするための各種機能を提供します。
- [`SchemaParsing/`](./SchemaParsing/README.md): nijo.xmlのXML要素の解析に関する機能を提供します。
- [`Models/`](./Models/README.md): モデル定義。nijo.xmlのルート要素直下のXML要素は、その種類によりどういったソースコードが生成されるかが異なります。例えば、永続化されるべきデータを表したモデル(DataModel)からは、RDBMSのテーブル定義や、Entity Framework Core のDbContextの設定が生成されます。例えば、画面や帳票に表示されるべきデータを表したモデル(QueryModel)からは、検索条件のオブジェクト定義や、検索処理が生成されます。このフォルダにはモデル毎にそのモデルからどういったソースコードが生成されるべきかを定義する処理が書かれています。
- [`ImmutableSchema/`](./ImmutableSchema/README.md): XMLスキーマの解析が通った後の、XMLスキーマが確定していることを前提とした各種クラス。コードの自動生成ではここにある各種クラスが利用されます。
- [`ValueMemberTypes/`](./ValueMemberTypes/README.md): 値型メンバーの型定義。単語型、整数型、日付型、日付時刻型など。
- [`Parts/`](./Parts/): スキーマ定義XMLに由来するモジュールではなく、生成後のソースに由来するモジュール。C#のORMであるEntity Framework CoreのDbContext, Node.js の.envファイル、NUnitのテスト定義など。
- [`Util.DotnetEx/`](./Util.DotnetEx/): .NET関連のユーティリティ。ここにある機能はコード自動生成処理でのみ参照されます。

## スキーマ定義の概要
スキーマ定義（nijo.xml）は、アプリケーションのデータモデル、クエリモデル、コマンドモデル、静的列挙型、値オブジェクトなどを定義するXMLファイルです。これを基にしてコード生成処理が実行され、Entity Frameworkのモデル、APIエンドポイント、UI部品などのソースコードが自動生成されます。

スキーマ定義の詳細な仕様については、各モデルタイプごとにそれぞれのフォルダ内のREADME.mdに記載されています。

## コーディング規約など、このプロジェクト開発者向けの記述
[CONTRIBUTING.md](./CONTRIBUTING.md) を参照してください。
