# Nijo プロジェクト
このプロジェクトは、スキーマ定義（nijo.xml）からソースコードを自動生成するプロジェクトです。
このプロジェクトが担うのはあくまでソース生成のみであり、生成されたあとのプロジェクトは、このプロジェクトを一切参照しません。

## プロジェクト構成
- [`CodeGenerating/`](./CodeGenerating/): ソースコード生成処理の実装を容易にするための各種機能を提供します。
- [`SchemaParsing/`](./SchemaParsing/): nijo.xmlのXML要素の解析に関する機能を提供します。
- [`Models/`](./Models/): モデル定義。nijo.xmlのルート要素直下のXML要素は、その種類によりどういったソースコードが生成されるかが異なります。例えば、永続化されるべきデータを表したモデル(DataModel)からは、RDBMSのテーブル定義や、Entity Framework Core のDbContextの設定が生成されます。例えば、画面や帳票に表示されるべきデータを表したモデル(QueryModel)からは、検索条件のオブジェクト定義や、検索処理が生成されます。このフォルダにはモデル毎にそのモデルからどういったソースコードが生成されるべきかを定義する処理が書かれています。
- [`ImmutableSchema/`](./ImmutableSchema/): XMLスキーマの解析が通った後の、XMLスキーマが確定していることを前提とした各種クラス。コードの自動生成ではここにある各種クラスが利用されます。
- [`ValueMemberTypes/`](./ValueMemberTypes/): 値型メンバーの型定義。単語型、整数型、日付型、日付時刻型など。
- [`Parts/`](./Parts/): スキーマ定義XMLに由来するモジュールではなく、生成後のソースに由来するモジュール。C#のORMであるEntity Framework CoreのDbContext, Node.js の.envファイル、NUnitのテスト定義など。
- [`Util.DotnetEx/`](./Util.DotnetEx/): .NET関連のユーティリティ。ここにある機能はコード自動生成処理でのみ参照されます。

## コーディング規約

### .editorconfig
[.editorconfig](../.editorconfig) に従ってください。

### ソースコードレンダリング処理
[SourceFile](./CodeGenerating/SourceFile.cs) を戻り値に持つメソッドや、そこから呼ばれる複数行のstringを戻り値にもつメソッドは、以下の方針に従ってください。

#### テンプレート文字列
C#のテンプレートリテラルの構文に従ってください。

OK
```cs
string RenderXXX() {
  return $$"""
    // ここに何らかのソースをレンダリングする
    """;
}
```

#### 分岐
何らかの条件に基づいて特定のソースをレンダリングするか否かが分かれる場合は `If()` , `.ElseIf()` , `.Else()` を使用してください。
また、それらのソースは、C#のテンプレートリテラルの構文の末尾の `"""` の位置とインデントを合わせて下さい。

OK

```cs
string RenderXXX() {
    return $$"""
        // ここに何らかのソースをレンダリングする
        {{If(/* 条件A */, () => $$"""
            // 条件Aを満たした場合のみレンダリングされるソース
        """).ElseIf(/* 条件B */, () => $$"""
            // 条件Bを満たした場合のみレンダリングされるソース
        """).Else(() => $$"""
            // 条件A, B いずれも満たさない場合のみレンダリングされるソース
        """)}}
        """;
}
```

NG

```cs
string RenderXXX() {
    return $$"""
        // ここに何らかのソースをレンダリングする
            {{If(/* 条件A */, () => $$"""
            // 条件Aを満たした場合のみレンダリングされるソース
            """).ElseIf(/* 条件B */, () => $$"""
            // 条件Bを満たした場合のみレンダリングされるソース
            """).Else(() => $$"""
            // 条件A, B いずれも満たさない場合のみレンダリングされるソース
            """)}}
        """;
}
```

### 反復
何らかの条件に基づいて特定のソースを反復処理する場合は `.SelectTextTemplate` メソッドを使ってください。
また、それらのソースは、C#のテンプレートリテラルの構文の末尾の `"""` の位置とインデントを合わせて下さい。

OK

```cs
string RenderXXX() {
    var array = Enumerable.Range(0, 4).Select(_ => "あ");
    return $$"""
        // ここに何らかのソースをレンダリングする
        {{array.SelectTextTemplate((_, i) => $$"""
            // {{i + 1}}番目の要素です。
        """)}}
        """;
}
```
