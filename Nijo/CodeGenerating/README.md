# コード生成エンジン
このフォルダには、スキーマ定義から実際のソースコードを生成するためのエンジン実装が含まれています。

## 主な責務
- スキーマ定義から各種コードを生成する処理を容易にする機能
  - 分岐（条件によってソースをレンダリングしたりしなかったりする場合の機能）
  - 反復（スキーマ定義にもとづいて似たソースを何度もレンダリングする場合の機能）
- ソースコードの入出力

## コード生成エンジンの外部仕様

### コードレンダリングコンテキスト
コード生成の中心となる [CodeRenderingContext](./CodeRenderingContext.cs) クラスについて説明します。

#### 主要メソッドとプロパティ
- `GenerateCode()`: コード生成を実行するメインメソッド
- `SchemaRoot`: スキーマ定義のルート要素へのアクセス
- `OutputDirectory`: 出力ディレクトリの設定
- `Models`: 登録されているすべてのモデル

#### レンダリング設定
[CodeRenderingConfig](./CodeRenderingConfig.cs) クラスで定義される設定について説明します。

- 出力言語（C#/TypeScript）
- ファイル名規則
- インデント設定
- コメント生成オプション

### モデルインターフェース
すべてのモデルが実装する [IModel](./IModel.cs) インターフェースについて説明します。

- `Render()`: モデルからソースコードを生成するメソッド
- `GetSourceFiles()`: 生成されるソースファイルのリストを取得
- `IsApplicable()`: モデルが適用可能かどうかを確認

### ソースファイル
生成されるソースファイルを表す [SourceFile](./SourceFile.cs) クラスについて説明します。

- ファイルパス
- コンテンツ
- 言語
- エンコーディング

### テンプレートテキストヘルパー
ソースコード生成を支援する [TemplateTextHelper](./TemplateTextHelper.cs) クラスについて説明します。

#### 条件分岐機能
条件に基づいてソースコードを生成する機能：

```csharp
If(condition, () => "条件が真のときのコード")
  .ElseIf(otherCondition, () => "別の条件が真のときのコード")
  .Else(() => "すべての条件が偽のときのコード")
```

#### 反復処理機能
コレクションの要素ごとにソースコードを生成する機能：

```csharp
collection.SelectTextTemplate(item => $"// {item.Name}のコード")
```

#### インデント管理
コードのインデントを適切に管理する機能：

```csharp
WithIndent(RenderChildCode(), "    ")
```

### 一括生成と部分生成
コード生成の範囲と方法について説明します。

#### 一括生成
スキーマ定義から一度にすべてのコードを生成する方法。

#### 部分生成
スキーマ定義の一部のみを対象にコードを生成する方法。

### 拡張ポイント
コード生成エンジンを拡張するための方法について説明します。

#### カスタムモデルの追加
新しいモデルタイプを追加する方法：

1. `IModel`インターフェースの実装
2. モデル固有のレンダリングロジックの実装
3. モデルの登録

#### カスタムテンプレートの追加
新しいソースコードテンプレートを追加する方法：

1. レンダリングメソッドの実装
2. 条件分岐や反復処理の適用
3. テンプレートの登録

#### 出力言語の拡張
新しい出力言語をサポートするための方法：

1. 言語固有のフォーマット設定
2. 命名規則の適用
3. 型マッピングの定義
